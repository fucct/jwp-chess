<!DOCTYPE>
<html>
<head>
    <meta charset="UTF-8">
    <link href="/css/index.css" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            src="https://code.jquery.com/jquery-3.4.1.slim.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" rel="stylesheet">
    <script crossorigin="anonymous"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</head>
<body>

<div class="container">
    <h1>전체 방 목록</h1>

    {{#if roomResponseDtos}}
    <table class="table table-hover">
        <thead>
        <tr>
            <th scope="col">방 번호</th>
            <th scope="col">방 제목</th>
            <th scope="col">삭제(새로고침해야 적용됩니다...)</th>
        </tr>
        </thead>
        <tbody>
        {{#each roomResponseDtos}}
        <tr>
            <td>{{this.roomId}}</td>
            <td>{{this.roomName}}</td>
            <td>
                <button class="btn btn-danger deleteButton" type="button">X</button>
            </td>
        </tr>
        {{/each}}
        </tbody>
    </table>
    {{else}}
    <h1>방이 하나도 개설되지 않았습니다!</h1>
    {{/if}}

    <form action="/roomResponseDtos/create" method="get">
        <div class="form-group">
            <small class="form-text text-muted">방을 만드려면 방 제목을 입력해주세요.</small>
            <input class="form-control" name="roomName" type="text">
        </div>
        <button class="btn btn-primary" type="submit">방 만들기</button>
    </form>

    <form action="/roomResponseDtos/enter" method="get">
        <div class="form-group">
            <small class="form-text text-muted">방에 입장하려면 방 번호를 입력해주세요.</small>
            <input class="form-control" name="roomId" placeholder="일단 있는 것만 입력해주세요 ㅎㅎ" type="text">
        </div>
        <button class="btn btn-primary" type="submit">방에 입장하기</button>
    </form>
</div>

<script src="/js/util.js" type="text/javascript"></script>
<script type="text/javascript">
    let allDeleteButton = document.querySelectorAll(".deleteButton");

    for (let i = 0; i < allDeleteButton.length; i++) {
        allDeleteButton[i].addEventListener('click', function () {
            let roomId = allDeleteButton[i].parentElement.parentElement.firstElementChild.innerHTML;
            deleteRoom(roomId);
        });
    }

    function deleteRoom(roomId) {
        console.log("deleteRoom : " + roomId);
        let oReq = new XMLHttpRequest();
        oReq.open('GET', '/roomResponseDtos/remove?roomId=' + roomId);
        oReq.send();
    }
</script>
</body>
</html>